@model ProyectoADS1.Models.ActaInspeccion

@{
    ViewData["Title"] = "Acta de Inspección";
}

<style>
    .documento {
        background-color: #fff;
        padding: 50px;
        margin: 20px auto;
        border: 1px solid #ccc;
        border-radius: 10px;
        max-width: 900px;
        box-shadow: 0 0 10px rgba(0,0,0,0.15);
        font-family: 'Segoe UI', Tahoma, sans-serif;
    }

        .documento h2, .documento h4, .documento h5 {
            text-align: center;
            font-weight: bold;
        }

        .documento hr {
            border-top: 2px solid #000;
        }

    label {
        font-weight: 600;
        margin-top: 8px;
    }

    .form-control[readonly] {
        background-color: #f9f9f9;
        border: none;
        border-bottom: 1px solid #ccc;
        border-radius: 0;
    }

    textarea.form-control {
        resize: none;
    }

    .firma-area {
        text-align: center;
        padding: 15px;
    }

    .firma-canvas {
        border: 1px solid #999;
        width: 100%;
        height: 180px;
        border-radius: 6px;
        background-color: #fdfdfd;
    }

    .nombre-firma {
        border-top: 1px solid #000;
        margin-top: 15px;
        padding-top: 5px;
        font-weight: 600;
    }

    .acciones-firma button {
        margin: 3px;
    }

    .seccion {
        margin-top: 20px;
    }

    .btn-primary {
        font-weight: 600;
        padding: 10px 25px;
        border-radius: 8px;
    }
</style>


<div class="documento">
    <h2>ACTA DE INSPECCIÓN</h2>
    <hr />

    <h5>Datos del Concesionario</h5>
    <div class="row">
        <div class="col-md-4">
            <label>RUC:</label>
            <input asp-for="IdInspeccionNavigation.Ruc" class="form-control" readonly />
        </div>
        <div class="col-md-4">
            <label>Nombre Comercial:</label>
            <input asp-for="IdInspeccionNavigation.NombreComercial" class="form-control" readonly />
        </div>
        <div class="col-md-4">
            <label>Razón Social:</label>
            <input asp-for="IdInspeccionNavigation.RazonSocial" class="form-control" readonly />
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <label>Dirección:</label>
            <input asp-for="IdInspeccionNavigation.Direccion" class="form-control" readonly />
        </div>
        <div class="col-md-4">
            <label>Departamento:</label>
            <input asp-for="IdInspeccionNavigation.Departamento" class="form-control" readonly />
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <label>Provincia:</label>
            <input asp-for="IdInspeccionNavigation.Provincia" class="form-control" readonly />
        </div>
        <div class="col-md-4">
            <label>Teléfono:</label>
            <input asp-for="IdInspeccionNavigation.Telefono" class="form-control" readonly />
        </div>
        <div class="col-md-4">
            <label>Email:</label>
            <input asp-for="IdInspeccionNavigation.Email" class="form-control" readonly />
        </div>
    </div>

    <div class="seccion">
        <h5>Detalles de la Inspección</h5>
        <div class="row">
            <div class="col-md-3">
                <label>ID Inspección:</label>
                <input asp-for="IdInspeccion" class="form-control" readonly />
            </div>
            <div class="col-md-5">
                <label>Área Supervisada:</label>
                <input asp-for="IdInspeccionNavigation.AreaSupervisada" class="form-control" readonly />
            </div>
            <div class="col-md-4">
                <label>Fecha Programada:</label>
                <input type="date" asp-for="IdInspeccionNavigation.FechaProgramada" class="form-control" readonly />
            </div>
        </div>

        <div class="mt-3">
            <label>Motivo de Inspección:</label>
            <textarea asp-for="IdInspeccionNavigation.MotivoInspeccion" class="form-control" rows="3" readonly></textarea>
        </div>
    </div>

    <form asp-action="ActaDeInspeccion" method="post">
        <input type="hidden" asp-for="IdInspeccion" />

        <div class="seccion">
            <h5>Observaciones</h5>
            <textarea asp-for="Observaciones" class="form-control" rows="3"></textarea>
        </div>

        <div class="seccion">
            <h5>Recomendaciones</h5>
            <textarea asp-for="Recomendaciones" class="form-control" rows="3"></textarea>
        </div>

        <div class="seccion">
            <h5>Conclusiones</h5>
            <textarea asp-for="Conclusiones" class="form-control" rows="3"></textarea>
        </div>

        <hr class="my-4" />

        <div class="row">
            <div class="col-md-6 firma-area">
                <h6>Firma del Supervisor</h6>
                <canvas id="firmaSupervisor" class="firma-canvas"></canvas>
                <div class="acciones-firma">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnLimpiarSupervisor">Limpiar</button>
                    <button type="button" class="btn btn-outline-success btn-sm" id="btnGuardarSupervisor">Guardar</button>
                </div>
                <input type="hidden" asp-for="FirmaSupervisorImagen" id="FirmaSupervisorImagen" />
                <div class="nombre-firma">Supervisor</div>
            </div>

            <div class="col-md-6 firma-area">
                <h6>Firma del Administrado</h6>
                <canvas id="firmaAdministrado" class="firma-canvas"></canvas>
                <div class="acciones-firma">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnLimpiarAdministrado">Limpiar</button>
                    <button type="button" class="btn btn-outline-success btn-sm" id="btnGuardarAdministrado">Guardar</button>
                </div>
                <input type="hidden" asp-for="FirmaAdministradoImagen" id="FirmaAdministradoImagen" />
                <div class="nombre-firma">Administrado</div>
            </div>
        </div>

        <div class="text-center mt-4">
            <input type="submit" value="Guardar Acta" class="btn btn-primary" />
        </div>
    </form>

    <div class="text-center mt-3">
        <a class="btn btn-secondary" asp-action="Index" asp-controller="Inspeccion">Regresar</a>
        <a class="btn btn-outline-primary" asp-action="CrearInforme" asp-controller="Informe" asp-route-id="@Model.IdInspeccion">Generar Informe PDF</a>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script>
        function setupSignature(canvasId, clearBtnId, saveBtnId, hiddenInputId, label) {
            const canvas = document.getElementById(canvasId);
            const pad = new SignaturePad(canvas);

            document.getElementById(clearBtnId).addEventListener("click", () => pad.clear());
            document.getElementById(saveBtnId).addEventListener("click", () => {
                if (pad.isEmpty()) {
                    alert(`⚠️ Dibuje la ${label} antes de guardar.`);
                    return;
                }
                const dataUrl = pad.toDataURL();
                document.getElementById(hiddenInputId).value = dataUrl;
                alert(`✅ ${label} guardada correctamente.`);
            });
        }

        setupSignature("firmaSupervisor", "btnLimpiarSupervisor", "btnGuardarSupervisor", "FirmaSupervisorImagen", "firma del supervisor");
        setupSignature("firmaAdministrado", "btnLimpiarAdministrado", "btnGuardarAdministrado", "FirmaAdministradoImagen", "firma del administrado");
    </script>
}
